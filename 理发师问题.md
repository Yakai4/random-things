# 理发师问题

某天，王道考研自习室楼下新开了⼀家餐厅——楼楼手作寿司店。这家店非常上流，有 n 位寿司师傅为客⼈提供⼀ 对⼀服务，现场做料理。⼀位客⼈到店时，需要先取号，并等待叫号。没有客⼈的时候，寿司师傅可以睡觉休息。 有客⼈的时候，只要有空闲的寿司师傅，就叫号，让下⼀位客⼈进店就餐，并由寿司师傅现场做料理。请使⽤P、V 操作描述上述过程的互斥与同步，并说明所⽤信号量及初值的含义。

```c
int waiting=0;				//等待服务的顾客数
semaphore mutex=1;			//互斥访问waiting
semaphore customer=0;		//顾客资源
semaphore server=0;			//服务员资源

server_i() {				//n个服务员进程
	while(1) {				
		P(customers);		//开始干活前，消耗一个“顾客资源”，若无顾客则睡眠休息
		P(mutex);			//互斥访问waiting变量
		waiting--;			//等待顾客数减一，相当于“叫号”
		V(server);			//释放一个“服务员资源”
		V(mutex);			//解锁waitng
		提供服务;			//根据题目给出中文描述
	}
}
customer() {				//顾客进程		
	P(mutex);				//进程互斥
	waiting++;				//等待顾客数+1，相当于“取号”
	V(customers);			//释放一个“顾客资源”
	V(mutex);				//开放临界区
	P(server);				//被服务前消耗一个“服务员资源”，若无空闲服务员则阻塞等待
	被服务;				//根据题目给出中文描述
}
```

某天，王道考研自习室楼下新开了⼀家餐厅——楼楼手作寿司店。这家店非常上流，有 n 位寿司师傅为客⼈提供⼀对⼀服务，现场做料理。⼀位客⼈到店时，需要先取号，并等待叫号。`这家店⽼板很黑心，没有客⼈的时候，寿司师傅也不可以睡觉休息，必须“忙等”`。有客⼈的时候，只要有空闲的寿司师傅，就叫号，让下⼀位客⼈进店就餐，并由寿司师傅现场做料理。请使用P、V操作描述上述过程的互斥与同步，并说明所⽤信号量及初值的含义。

```c
int waiting=0;				//等待服务的顾客数
semaphore mutex=1;			//互斥访问waiting
semaphore customer=0;		//顾客资源
semaphore server=0;			//服务员资源

server_i() {				//n个服务员进程
	while(1) {				
		P(mutex);			//互斥访问waiting变量
		if(waiting > 0) {	//有顾客
            waiting--;		//叫号
            V(server);		//释放一个“服务员资源”
            V(mutex);		//
        } else {			//没有顾客
            V(mutex);		//开放对waiting变量的锁
            continue;		//忙等
        }
		提供服务;			//根据题目给出中文描述
	}
}
customer() {				//顾客进程		
	P(mutex);				//进程互斥
	waiting++;				//等待顾客数+1，相当于“取号”
	V(customers);			//释放一个“顾客资源”
	V(mutex);				//开放临界区
	P(server);				//被服务前消耗一个“服务员资源”，若无空闲服务员则阻塞等待
	被服务;				//根据题目给出中文描述
}
```

某天，王道考研自习室楼下新开了⼀家餐厅——楼楼⼿作寿司店。这家店非常上流，有 n 位寿司师傅为客人提供⼀对⼀服务，现场做料理。为了营造“这家店很火”的感觉，老板在店门口摆了`m个等位座椅`供客⼈等位使用。⼀位客人到店时，会先观察还有没有等位座椅，如果没有座椅可⽤，就转身离开；如果有座椅可用，就会先取号，并坐下等待叫号。没有客⼈的时候，寿司师傅可以睡觉休息。有客⼈的时候，只要有空闲的寿司师傅，就叫号，让下⼀位客⼈进店就餐，并由寿司师傅现场做料理。请使用P、V操作描述上述过程的互斥与同步，并说明所用信号量及初值的含义。

```C
int waiting=0;				//等待服务的顾客数
semaphore mutex=1;			//互斥访问waiting
semaphore customer=0;		//顾客资源
semaphore server=0;			//服务员资源

server_i() {				//n个服务员进程
	while(1) {	
    	P(customers);		//开始干活前，消耗一个“顾客资源”，若无顾客则睡眠
		P(mutex); 			//互斥访问waiting变量
         waiting--;			//叫号
         V(server);			//释放一个“服务员资源”
         V(mutex);			//开放对waiting变量的锁
		提供服务;			//根据题目给出中文描述
	}
}
customer() {				//顾客进程		
	P(mutex);				//进程互斥
	if(waiting<m) {
        waiting++;			//等待顾客数+1，相当于“取号”
        V(customers);		//释放一个“顾客资源”
        V(mutex);			//开放临界区
        P(server);			//被服务前消耗一个“服务员资源”，若无空闲服务员则阻塞等待
        被服务;			//根据题目给出中文描述
	} else {
		V(mutex);			//人满，离开
	}
}
```

